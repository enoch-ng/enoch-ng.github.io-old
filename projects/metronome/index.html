<!DOCTYPE html>
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
		<title>Enoch Ng – Metronome</title>
		<link href="https://fonts.googleapis.com/css?family=Montserrat" rel="stylesheet">
		<link href="https://fonts.googleapis.com/css?family=Cormorant+Garamond:500" rel="stylesheet">
		<link href="https://fonts.googleapis.com/css?family=Crimson+Text:400,600" rel="stylesheet">
		<link href="https://fonts.googleapis.com/css?family=Great+Vibes" rel="stylesheet">
		<link rel="stylesheet" type="text/css" href="theme.css">
		<script type="text/javascript">
			function metronome() {
				var DEFAULT_BPM = 120;
				var tempo = DEFAULT_BPM;
				var t = 0; // Variable for keeping track of time with the metronome. If t = 0, metronome is off.
				var time_interval = 60000.0 / tempo; // Time to wait between clicks, in ms
				var click = new Audio('click.wav');
				var click2 = new Audio('click.wav');
				var which_click = true; // please replace this with something better later my god
				var beats_per_measure = 4;
				
				var up = new Image(),
					down = new Image(),
					onoff = new Image();
				
				up.src = 'up.png';
				down.src = 'down.png';
				onoff.src = 'onoff.png';
				
				var canvas = document.getElementById('metronome');
				
				if (canvas.getContext) {
					var context = canvas.getContext('2d');
				}
				
				context.font = '24px serif';
				canvas.addEventListener('click', function(event) {
					var x = event.pageX - canvas.offsetLeft,
						y = event.pageY - canvas.offsetTop;
						
					if (y > 0 && y < 64 && x > 0 && x < 64) {
						console.log('Up');
						tempo += 4;
						time_interval = 60000.0 / tempo;
					}
					
					else if (y > 0 && y < 64 && x > 200 && x < 264) {
						console.log('Down');
						tempo -= 4;
						time_interval = 60000.0 / tempo;
					}
					
					else if (y > 300 && y < 364 && x > 200 && x < 456) {
						if (t == 0) {
							console.log('On');
							t = Date.now();
							click.play();
							console.log('*click*');
						}	
						
						else { 
							console.log('Off');
							t = 0;
						}
					}
				}, false);
				
				window.requestAnimationFrame(draw);
				
				function draw() {
					if (t > 0 && Date.now() > t + time_interval) {
						if (which_click) { click.play(); }
						else { click2.play(); }
						console.log('*click*');
						t += time_interval;
						which_click = !which_click;
					}
				
					context.clearRect(0, 0, canvas.width, canvas.height);
					
					context.drawImage(up, 0, 0);
					context.fillText(tempo + ' BPM', 85, 40);
					context.drawImage(down, 200, 0);
					context.drawImage(onoff, 200, 300);
				
					window.requestAnimationFrame(draw);
				}
			}
		</script>
	</head>	
	
	<body onload="metronome();">
		<h1><a href="/">Enoch Ng</a></h1>
		<p id="tagline">Music • Writing • Programming</p>
		<ol id="nav">
			<li><a href="/about/">About</a></li>
			<li><a href="/projects/">Projects</a></li>
			<li><a href="/compositions/">Compositions</a></li>
			<li><a href="/arrangements/">Arrangements</a></li>
			<li><a href="/essays/">Essays</a></li>
			<li><a href="/contact/">Contact</a></li>
		</ol>
		
		<div id="main_body">
			<h2>Metronome</h2>
			<div id="content">
				<canvas id="metronome" width="640" height="480">Your browser does not support this.</canvas>
			</div>
		</div>
		
		<div id="footer">
			<p>Copyright &copy; 2017 Enoch Ng</p>
		</div>
	</body>
</html>